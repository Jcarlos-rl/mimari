---
import Layout from '../layouts/Layout.astro';

const birthdayMari = "12Mayo",
	pistas = [
		'Dos n√∫meros consecutivos que forman parte de tu dia a dia',
		'Es en el mes de las flores',
		'Fui regalo de mi "mam√°" dos dias despu√©s y de mi abuela 3 dias antes'
	];

---

<Layout title="Mis 3 a√±os">
	<div class="h-dvh w-full absolute bg-[url('/images/back.webp')] bg-center bg-cover">
	</div>
	<main class="relative container mx-auto px-6 md:px-0">
		<section class="h-dvh flex items-center justify-center">
			<div>
				<h1 class="icekingdom text-4xl font-semibold text-center mb-8 text-cyan-500">Algo importante para mi se acerca.</h1>
				<p class="oswald text-lg text-center text-slate-600">Pero antes, necesito hacerte una pregunta...</p>
				<p class="oswald text-lg text-center font-semibold text-cyan-600">¬øSabes qu√© d√≠a nac√≠?</p>
				<div class="flex justify-center mt-4 gap-4">
					<div>
						<label for="day" class="block mb-2 text-sm font-medium text-gray-900">Selecciona el d√≠a</label>
						<select id="day" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
								<option selected value="01">01</option>
								<option value="02">02</option>
								<option value="03">03</option>
								<option value="04">04</option>
								<option value="05">05</option>
								<option value="06">06</option>
								<option value="07">07</option>
								<option value="08">08</option>
								<option value="09">09</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
								<option value="13">13</option>
								<option value="14">14</option>
								<option value="15">15</option>
								<option value="16">16</option>
								<option value="17">17</option>
								<option value="18">18</option>
								<option value="19">19</option>
								<option value="20">20</option>
								<option value="21">21</option>
								<option value="22">22</option>
								<option value="23">23</option>
								<option value="24">24</option>
								<option value="25">25</option>
								<option value="26">26</option>
								<option value="27">27</option>
								<option value="28">28</option>
								<option value="29">29</option>
								<option value="30">30</option>
								<option value="31">31</option>
						</select>
					</div>
					<div>
						<label for="month" class="block mb-2 text-sm font-medium text-gray-900">Selecciona el mes</label>
						<select id="month" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
								<option selected value="Enero">Enero</option>
								<option value="Febrero">Febrero</option>
								<option value="Marzo">Marzo</option>
								<option value="Abril">Abril</option>
								<option value="Mayo">Mayo</option>
								<option value="Junio">Junio</option>
								<option value="Julio">Julio</option>
								<option value="Agosto">Agosto</option>
								<option value="Septiembre">Septiembre</option>
								<option value="Octubre">Octubre</option>
								<option value="Noviembre">Noviembre</option>
								<option value="Diciembre">Diciembre</option>
						</select>
					</div>
					<!-- <input id="datetime" class="w-[200px] text-pink-400" type="date" value={ todayDate }> -->
				</div>
				<div class="flex justify-center mb-[150px]">
					<button id="date" type="button" class="mt-4 text-white bg-gradient-to-r from-cyan-400 via-cyan-500 to-cyan-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-cyan-300 shadow-lg shadow-cyan-500/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">Aceptar</button>
				</div>
				
			</div>
		</section>
	</main>
	<div id="backdrop_sidebar" class="bg-gray-100/90 fixed inset-0 z-30 hidden">
		<div class="h-dvh flex justify-center items-center">
			<div id="content_base">
				<p class="text-center text-xl font-semibold text-pink-300">Le preguntar√© a mi mam√°...</p>
				<img src="/images/olaf.gif" alt="">
			</div>
			<div id="content_response" class="hidden">
			</div>
		</div>
	</div>
</Layout>

<style>
	input[type="date"] {
		display:block;
		position:relative;
		padding:1rem 3.5rem 1rem 0.75rem;
		font-size:1rem;
		border-radius:0.25rem;
		background:
			white
			url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='22' viewBox='0 0 20 22'%3E%3Cg fill='none' fill-rule='evenodd' stroke='%23f9a8d4' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' transform='translate(1 1)'%3E%3Crect width='18' height='18' y='2' rx='2'/%3E%3Cpath d='M13 0L13 4M5 0L5 4M0 8L18 8'/%3E%3C/g%3E%3C/svg%3E")
			right 1.5rem
			center
			no-repeat;
		
		cursor:pointer;
	}

	input[type="date"]:focus {
  		outline:none;
  		border-color:#3acfff;
  		box-shadow:0 0 0 0.25rem rgba(0, 120, 250, 0.1);
	}

	::-webkit-datetime-edit {}
	::-webkit-datetime-edit-fields-wrapper {}
	::-webkit-datetime-edit-month-field:hover,
	::-webkit-datetime-edit-day-field:hover,
	::-webkit-datetime-edit-year-field:hover {
		background:rgba(0, 120, 250, 0.1);
	}

	::-webkit-datetime-edit-text {
		opacity:0;
	}

	::-webkit-clear-button,
	::-webkit-inner-spin-button {
		display:none;
	}
	::-webkit-calendar-picker-indicator {
		position:absolute;
		width:2.5rem;
		height:100%;
		top:0;
		right:0;
		bottom:0;
		opacity:0;
		cursor:pointer;
		color:rgba(0, 120, 250, 1);
		background:rgba(0, 120, 250, 1);
	}

	input[type="date"]:hover::-webkit-calendar-picker-indicator { opacity:0.05; }
	input[type="date"]:hover::-webkit-calendar-picker-indicator:hover { opacity:0.15; }
</style>

<script define:vars={{ birthdayMari, pistas }}>
	const date = document.querySelector('#date'),
		day = document.querySelector('#day'),
		month = document.querySelector('#month'),
		backdrop_sidebar = document.querySelector('#backdrop_sidebar'),
		content_base = document.querySelector('#content_base'),
		content_response = document.querySelector('#content_response'),
		img_olaf = document.querySelector('#content_base img');
	
	let pist = 0;
	
	function getRandomInt(max) {
		return Math.floor(Math.random() * max);
	}

	date.addEventListener('click', ()=>{
		const userDate = day.value+month.value;
		backdrop_sidebar.classList.remove('hidden');
		content_response.innerHTML = '';
		date.blur();

		if(birthdayMari === userDate){
			content_response.innerHTML = `
			<p class="oswald text-lg text-center text-cyan-600">Ahora te quiero m√°s ü´∂</p>
			<div class="flex justify-center">
				<img class="my-6" src="/images/correcto${getRandomInt(3)+1}.webp" width="120" alt="">
			</div>
			<p class="oswald text-lg text-center text-cyan-600">Continuemos...</p>
			`;
		}else{
			let textPista = (pist === 3) ? 'Bueno, solo porque me caes bien te dejare pasar.' : pistas[pist];
			let textPistaPrin = (pist === 3) ? '' : 'No puedo creerlo, te dare una pista:';
			let btnPistaPrin = (pist === 3) ? '' : '<button type="button" class="mt-4 text-white bg-gradient-to-r from-cyan-400 via-cyan-500 to-cyan-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-cyan-300 shadow-lg shadow-cyan-500/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">Volver a intentar</button>';
			content_response.innerHTML = `
			<p class="oswald text-lg text-center text-pink-600">${textPistaPrin}</p>
			<div class="flex justify-center">
				<img class="my-6" src="/images/incorrecto${getRandomInt(3)+1}.webp" width="120" alt="">
			</div>
			<p class="oswald text-lg text-center text-pink-700">${ textPista }</p>
			<div class="flex justify-center">
				${btnPistaPrin}
			</div>
			`;

			pist = pist + 1;
		}

		
		setTimeout(() => {
			content_base?.classList.add('hidden');
			content_response?.classList.remove('hidden');
			if(birthdayMari === userDate || pist === 4){
				setTimeout(() => {
					window.location.href = '/invitacion';
				}, 5000);
			}
		}, 4000);	
	});

	content_response.addEventListener('click', (e)=>{
		if(e.target.tagName === "BUTTON"){
			img_olaf.src = `/images/olaf.gif?a=${getRandomInt(5)}`;
			backdrop_sidebar.classList.add('hidden');
			content_base?.classList.remove('hidden');
			content_response?.classList.add('hidden');
		}
	})
</script>